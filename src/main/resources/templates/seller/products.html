<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layouts/layout}">
<head>
    <title>My Products - Marketplace</title>
</head>
<body>
    <div th:fragment="content">
        <div class="container py-8">
            <div class="flex items-center gap-4 mb-6">
                <a th:href="@{/seller/products}" class="font-medium text-primary border-b-2 border-primary pb-2">Products</a>
                <a th:href="@{/seller/orders}" class="text-gray-600 hover:text-primary">Sales & Orders</a>
            </div>
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">My Products</h1>
                    <p class="text-gray-600 mt-1">Manage your products, drafts and publications</p>
                </div>
                <button id="addProductBtn" class="btn-primary flex items-center gap-2">
                    <span>+</span>
                    <span>Add product</span>
                </button>
            </div>

            <div class="product-grid" th:if="${products != null and !products.isEmpty()}">
                <div th:each="product : ${products}" class="seller-product-card" th:attr="data-id=${product.id}">
                    <a th:href="@{/products/{id}(id=${product.id})}" class="block flex-1" th:if="${product.status == 'PUBLISHED'}">
                        <div class="product-card-image">
                            <img th:if="${product.images != null and !product.images.isEmpty()}"
                                 th:src="${product.images[0]}"
                                 alt="Product image"
                                 onerror="this.src='/images/placeholder.png'; this.onerror=null;">
                            <div th:unless="${product.images != null and !product.images.isEmpty()}"
                                 class="image-placeholder h-full flex items-center justify-center text-gray-400">No photo</div>
                            <div class="product-card-badge" th:classappend="${product.status == 'DRAFT'} ? 'bg-amber-500' : 'bg-green-600'"
                                 th:text="${product.status}">Status</div>
                        </div>
                    </a>
                    <div th:if="${product.status == 'DRAFT'}" class="block flex-1 cursor-default">
                        <div class="product-card-image">
                            <img th:if="${product.images != null and !product.images.isEmpty()}"
                                 th:src="${product.images[0]}"
                                 alt="Product image"
                                 onerror="this.src='/images/placeholder.png'; this.onerror=null;">
                            <div th:unless="${product.images != null and !product.images.isEmpty()}"
                                 class="image-placeholder h-full flex items-center justify-center text-gray-400">No photo</div>
                            <div class="product-card-badge bg-amber-500">DRAFT</div>
                        </div>
                    </div>
                    <div class="product-card-content p-4">
                        <h3 class="product-card-title font-semibold" th:text="${product.title}">Product Title</h3>
                        <div class="mt-2 space-y-1 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-500">Price</span>
                                <span class="font-bold text-primary" th:text="'$' + ${#numbers.formatDecimal(product.price, 1, 2)}">$0.00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Stock</span>
                                <span th:text="${product.stock}">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Category</span>
                                <span th:text="${product.category}">-</span>
                            </div>
                            <div class="flex justify-between" th:if="${product.rating > 0}">
                                <span class="text-gray-500">Rating</span>
                                <span>★ <span th:text="${#numbers.formatDecimal(product.rating, 1, 1)}">0</span> (<span th:text="${product.reviewCount}">0</span>)</span>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2 mt-4">
                            <button type="button" class="seller-edit-btn btn-secondary py-2 px-3 text-sm flex-1"
                                    th:attr="data-id=${product.id}">Edit</button>
                            <button type="button" th:if="${product.status == 'DRAFT'}"
                                    class="seller-publish-btn btn-primary py-2 px-3 text-sm flex-1"
                                    th:attr="data-id=${product.id}">Publish</button>
                            <button type="button" th:if="${product.status == 'PUBLISHED'}"
                                    class="seller-unpublish-btn bg-amber-100 text-amber-800 hover:bg-amber-200 py-2 px-3 text-sm rounded-lg flex-1"
                                    th:attr="data-id=${product.id}">Unpublish</button>
                            <button type="button" class="seller-delete-btn bg-red-50 text-red-600 hover:bg-red-100 py-2 px-3 text-sm rounded-lg"
                                    th:attr="data-id=${product.id}">Delete</button>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${products == null or products.isEmpty()}" class="text-center py-16 bg-white rounded-xl border border-gray-200">
                <p class="text-gray-500 mb-4">You have no products yet</p>
                <button id="addProductBtnEmpty" class="btn-primary">+ Add your first product</button>
            </div>

            <div class="mt-8 flex justify-center items-center gap-4" th:if="${totalPages != null and totalPages > 1}">
                <a th:if="${currentPage > 0}"
                   th:href="@{/seller/products(page=${currentPage - 1})}"
                   class="btn-secondary px-6 py-2">← Previous</a>
                <span class="text-gray-600 font-medium" th:text="'Page ' + (${currentPage} + 1) + ' of ' + ${totalPages}">Page 1 of 1</span>
                <a th:if="${currentPage < totalPages - 1}"
                   th:href="@{/seller/products(page=${currentPage + 1})}"
                   class="btn-secondary px-6 py-2">Next →</a>
            </div>
        </div>

        <!-- Add/Edit Product Modal -->
        <div id="productModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b">
                    <h2 id="modalTitle" class="text-xl font-bold">Add product</h2>
                </div>
                <form id="productForm" class="p-6 space-y-4">
                    <input type="hidden" id="productId" name="id">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                        <input type="text" id="productTitle" name="title" required class="form-input" placeholder="Product name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
                        <textarea id="productDescription" name="description" required class="form-input min-h-[100px]" placeholder="Product description"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                        <input type="text" id="productCategory" name="category" required class="form-input" placeholder="e.g. Electronics">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Price *</label>
                        <input type="number" id="productPrice" name="price" step="0.01" min="0" required class="form-input" placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Stock</label>
                        <input type="number" id="productStock" name="stock" min="0" value="0" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Image URLs (one per line, .png .jpg .jpeg only)</label>
                        <textarea id="productImages" name="images" class="form-input min-h-[80px]" placeholder="/images/product.png"></textarea>
                    </div>
                </form>
                <div class="p-6 border-t flex justify-end gap-3">
                    <button type="button" id="modalCancel" class="btn-secondary">Cancel</button>
                    <button type="button" id="modalSave" class="btn-primary">Save</button>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            const csrf = document.querySelector('meta[name="_csrf"]')?.content || '';
            const categories = /*[[${categories}]]*/ [];
        </script>
        <script th:src="@{/js/seller-products.js}"></script>
    </div>
</body>
</html>
