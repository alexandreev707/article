<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout}">
<head>
    <title>Checkout - Marketplace</title>
    <style>
        .payment-carousel { display: flex; gap: 12px; overflow-x: auto; padding: 8px 0; scroll-snap-type: x mandatory; }
        .payment-option { flex: 0 0 140px; scroll-snap-align: start; padding: 16px; border-radius: 12px; border: 2px solid #E5E7EB; cursor: pointer; text-align: center; transition: all 0.2s; }
        .payment-option:hover { border-color: #005BFF; background: #F0F7FF; }
        .payment-option.selected { border-color: #005BFF; background: #EFF6FF; }
    </style>
</head>
<body>
    <div th:fragment="content">
        <div class="container py-8">
            <a href="/cart" class="text-primary hover:underline mb-6 inline-block">‚Üê Back to cart</a>
            <h1 class="text-3xl font-bold text-gray-900 mb-8">Checkout</h1>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Left: Payment & Delivery -->
                <div class="flex-1 space-y-6">
                    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6">
                        <h2 class="text-lg font-bold text-gray-900 mb-4">Payment method</h2>
                        <div class="payment-carousel" id="paymentCarousel">
                            <div class="payment-option selected" data-method="card" tabindex="0">üí≥ Card online</div>
                            <div class="payment-option" data-method="bank" tabindex="0">üè¶ Bank</div>
                            <div class="payment-option" data-method="sbp" tabindex="0">üì± SBP</div>
                            <div class="payment-option" data-method="pay" tabindex="0">‚úì Pay</div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6">
                        <h2 class="text-lg font-bold text-gray-900 mb-4">Delivery</h2>
                        <p class="text-sm text-gray-600 mb-4">Select delivery method</p>
                        <div class="space-y-3" id="deliveryOptions">
                            <div class="flex items-center justify-between p-4 rounded-lg border border-gray-200 hover:border-primary cursor-pointer delivery-option" data-id="0">
                                <div>
                                    <span class="font-medium">Loading...</span>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="selectedDeliveryId" name="deliveryOptionId" value="">
                    </div>
                </div>

                <!-- Right: Order summary -->
                <div class="lg:w-96 flex-shrink-0">
                    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6 sticky top-24">
                        <button type="button" id="payBtn" class="btn-primary w-full py-3 text-lg font-semibold mb-4">
                            Top up and pay
                        </button>
                        <p class="text-xs text-gray-500 mb-4">By clicking the button, you agree to the Terms of use and Privacy policy.</p>
                        <h2 class="text-lg font-bold text-gray-900 mb-4">Your order</h2>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Discount amount (optional)</label>
                            <input type="number" id="discountInput" min="0" step="0.01" placeholder="0.00" class="form-input w-full">
                        </div>
                        <div id="orderSummary">
                            <p class="text-gray-600 text-sm" id="summaryLine">0 items</p>
                            <div class="mt-2 space-y-1 text-sm">
                                <div class="flex justify-between"><span>Items</span><span id="itemsTotal">$0.00</span></div>
                                <div class="flex justify-between text-red-600" id="discountRow"><span>Discount</span><span id="discountAmount">-$0.00</span></div>
                                <div class="flex justify-between text-green-600" id="deliveryRow"><span>Delivery</span><span id="deliveryCost">Free</span></div>
                            </div>
                            <p class="text-xl font-bold text-primary mt-4 pt-4 border-t" id="totalPrice">$0.00</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            window.currentUser = /*[[${currentUser}]]*/ null;
        </script>
        <script th:src="@{/js/checkout.js}"></script>
    </div>
</body>
</html>
